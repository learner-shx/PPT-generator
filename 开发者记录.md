# 开发者记录

## 前言

此项目是2019级武汉大学计算机学院弘毅班 "软件工程" 的课程作业,课程要求每个小组完成一个中型项目,体验软件工程开发过程.

课程前期的准备开发过程以及相关的文档均已上传,见[开发过程文档](开发过程文档.md)

小组: SE14 - PPT自动生成器

组长: 孙含笑
组员: 陆知行
组员: 徐梓峻
组员: 陶文琪

参考视频资料[微信小程序开发](https://www.bilibili.com/video/BV1834y1676P)

## 数据库表

**新建数据库表之前需按如下模板创建并填入相关信息**,如后续修改数据库表格式,此处应同步更新

关于数据类型和相关方法请参考[文档](https://developers.weixin.qq.com/miniprogram/dev/reference/wxs/06datatype.html)

```markdown
### 数据库名

- 含义: 
- 权限: 
- 数据项:

  |名称|数据类型|含义|
  |:--:|:--:|:--:|
  ||||

- 相关说明和注意事项:

  
```

### announcement

- 含义: 公告信息
- 权限: 所有用户可读,仅创建者可写
- 数据项:

  |名称|数据类型|含义|
  |:--:|:--:|:--:|
  |time|date|公告发布时间|
  |content|string|公告内容|

- 相关说明和注意事项:

  管理员输入公告后默认插入在列表的头部,列表不需反转即可按时间顺序排序

### user

- 含义: 用户记录
- 权限: 仅创建者可读写
- 数据项:

  |名称|数据类型|含义|
  |:--:|:--:|:--:|
  |username|string|用户昵称|
  |call|string|电话|
  |email|string|邮箱|

- 相关说明和注意事项:

### message

- 含义: 消息记录
- 权限: 所有用户可读,仅创建者可写
- 数据项:

  |名称|数据类型|含义|
  |:--:|:--:|:--:|
  |userA_openid|string|用户A的_openid|
  |userB_openid|string|用户B的_openid|
  |message_type|bool|消息类型,false为系统消息,true为用户消息|
  |A_is_visable|bool|对A消息是否可见,false为不可见,true为可见|
  |B_is_visable|bool|对B消息是否可见,false为不可见,true为可见|
  |message_list|array[{<br>"_openid" : string,<br> "text" : string,<br> "time" : date<br>}]|[消息记录]</br>发送者的_openid<br>发送内容</br>发送时间|

- 相关说明和注意事项:

  - 系统消息是单项建立的,用户消息是双向建立的,需要查询userA/B的_openid得到用户的消息列表
  - 为避免冗余,message表中仅包含用户的_openid信息,其余(昵称,头像)等信息查询user表获取
  - is_visable属性用于判断用户是否隐藏该信息

    - `左滑`关闭聊天后设置此项为 `false`
    - 点击头像进入聊天后设置此项为 `true`
    - 默认 `true`


## 常用自定义函数功能

### getUserInfoFromOpenid

- 功能: 通过用户的_openid查询用户的信息(userName + avatarUrl)
- 使用场景: 针对用户修改头像/用户名需要使用_openid作为标识符
- 参数:

  - 输入: _openid: string
  - 输出: user_info: {"_openid": _openid, "userName":userName, "avatarUrl":avatarUrl}

- 注意事项: **单用户查询**,多用户查询请使用 `getUsersInfoFromOpenids`
- 补充: 无

### getUsersInfoFromOpenids

- 功能: 通过多用户的openid查询对于用户的信息(userName + avatarUrl)
- 使用场景: 针对用户修改头像/用户名需要使用_openid作为标识符
- 参数:
  
  - 输入: openids: array[string]
  - 输出: users_info: array[{"_openid": _openid, "userName":userName,"avatarUrl":avatarUrl}]

- 注意事项: 无
- 补充: 输出的 `users_info` 与输入参数的 `openids` 次序一致